---
// Assets
import BigLogo from "@/components/assets/BigLogo.astro";
// Fundations
import Button from "@/components/fundations/elements/Button.astro";
import Link from "@/components/fundations/elements/Link.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
// Icons
import Plus from "@/components/fundations/icons/Plus.astro";
// Components
import BlogSearch from "@/components/blog/BlogSearch.astro";
import EntryTicker from "@/components/blog/EntryTicker.astro";
import { getCollection } from "astro:content";

// Get all podcasts
const allPodcasts = await getCollection("podcast");
allPodcasts.sort((a, b) => {
  const dateA = new Date(a.data.pubDate).getTime(); // Convert to timestamp
  const dateB = new Date(b.data.pubDate).getTime(); // Convert to timestamp
  return dateB - dateA; // Compare timestamps
});
// Get all posts
const allPosts = await getCollection("posts");
allPosts.sort((a, b) => {
  const dateA = new Date(a.data.pubDate).getTime(); // Convert to timestamp
  const dateB = new Date(b.data.pubDate).getTime(); // Convert to timestamp
  return dateB - dateA; // Compare timestamps
});
// Sort posts by date and grab the latest 6
const latestPosts = [...allPosts]
  .sort(
    (a, b) =>
      new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  )
  .slice(0, 6);
// Tags
const tags = [...new Set(allPosts.map((post) => post.data.tags).flat())];
// Array
---

<section id="navigation" class="overflow-hidden">
  <Wrapper variant="standard" class="flex flex-col pt-4">
    <div class="fixed z-50 top-1 pr-4">
      <div class="relative">
        <div
          class="absolute inset-0 pointer-events-nono bg-black/20 backdrop-blur-2xl rounded-2xl"
        >
        </div>
        <div
          class="rounded-2xl flex itmes-start lg:items-center gap-1 p-1 relative"
        >
          <Link href="/" size="sm" variant="default">
            <span class="sr-only">Home</span>
            Making the Metaverse
          </Link>
          <Button
            id="dropdown-toggle"
            size="sm"
            variant="orange"
            iconOnly
            class="shrink-0"
          >
            <Plus slot="icon" size="sm" />
          </Button>
          <BlogSearch />

          <div
            id="dropdown-panel"
            class="hidden w-full duration-300 ease-in-out"
          >
            <div class="flex flex-wrap gap-1">
              <Link
                href="https://buy.polar.sh/polar_cl_Ud7LKuiTum4KOh18ACTaikj9T-YIeLBfyVqFQZ66Rt0"
                size="sm"
                variant="pink"
              >
                Buy Snowpeak
              </Link>
              <Link href="/system/overview" size="sm" variant="muted">
                Overview
              </Link>
              <Link href="/index-2" size="sm" variant="muted"> Blog </Link>
              <Link href="/podcast/home" size="sm" variant="muted">
                Podcast
              </Link>
              {
                tags.map((tag) => {
                  const formattedTag = tag.replace(/-/g, " ");
                  return (
                    <Link
                      size="sm"
                      variant="muted"
                      href={`/blog/tags/${tag}`}
                      class="font-medium capitalize"
                    >
                      {formattedTag}
                    </Link>
                  );
                })
              }
              <Link href="/forms/sign-in" size="sm" variant="accent">
                Sign in
              </Link>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      id="bigLogo"
      class="p-10 mt-12 rounded-4xl lg:rounded-[5rem] bg-base-900 lg:p-40"
    >
      <BigLogo class="text-white relative" />
    </div>
    <div id="tickerElement">
      <div
        class="relative flex items-center order-last px-2 py-2 overflow-x-scroll snap-x snap-proximity scrollbar-hide animate-marquee w-max pause-on-hover"
      >
        {latestPosts.map((post) => <EntryTicker post={post} />)}
      </div>
    </div>
  </Wrapper>
</section>

<script type="module">
  document.addEventListener("DOMContentLoaded", () => {
    const toggle = document.getElementById("dropdown-toggle");
    const panel = document.getElementById("dropdown-panel");

    toggle.addEventListener("click", () => {
      panel.classList.toggle("hidden");
    });
  });
</script>
